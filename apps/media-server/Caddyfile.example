# Example Caddyfile for reverse proxy + static file serving
# Place this in your Caddy config or use with docker-compose

media.yourdomain.com {
    # Handle uploads via API
    handle /upload* {
        reverse_proxy media-api:3001
    }

    handle /health {
        reverse_proxy media-api:3001
    }

    # Serve files directly from Caddy for better performance
    handle /files/* {
        root * /srv
        file_server {
            precompressed gzip br
        }

        # Cache headers for immutable content
        header Cache-Control "public, max-age=31536000, immutable"

        # CORS headers
        header Access-Control-Allow-Origin "*"
        header Access-Control-Allow-Methods "GET, HEAD, OPTIONS"
    }

    # Default: proxy to API
    handle {
        reverse_proxy media-api:3001
    }
}
